---
title:  "macOS Homebrew MAMP ç’°å¢ƒè¨­ç½®ï¼šApache + PHP-FPM + MariaDB"
date:   2025-11-27 14:00:00 +0800
categories: AI
tags: [MAMP, mac, httpd, PHP, mariadb, joomla]
---
ä»¥ä¸‹æ˜¯é‡å°ã€ŒmacOS Homebrew MAMP ç’°å¢ƒè¨­ç½®ï¼šApache + PHP-FPM + MariaDB (Joomla é©ç”¨)ã€çš„å®Œæ•´å¿ƒå¾—ç­†è¨˜ã€‚
# ğŸ’» macOS Homebrew MAMP ç’°å¢ƒè¨­ç½®ï¼šApache + PHP-FPM + MariaDB (Joomla é©ç”¨)

æœ¬æ–‡è¨˜éŒ„äº†åœ¨ macOS ä¸Šä½¿ç”¨ Homebrew å®‰è£ä¸¦é…ç½® Apacheã€PHP-FPM å’Œ MariaDB ç’°å¢ƒçš„å®Œæ•´éç¨‹ï¼Œç‰¹åˆ¥è‘—é‡æ–¼è§£æ±ºå®‰è£ MariaDB æ™‚é‡åˆ°çš„å¸¸è¦‹éŒ¯èª¤èˆ‡æ¬Šé™å•é¡Œï¼Œä»¥åŠä¸²æ¥é«˜æ•ˆèƒ½çš„ PHP-FPMã€‚

## ğŸ¯ å¿…å‚™è»Ÿé«”

* macOS (å·²å®‰è£ Homebrew)
* çµ‚ç«¯æ©Ÿ (Terminal)

---

## Part 1: ç’°å¢ƒæª¢æŸ¥èˆ‡ Apache/PHP æº–å‚™

1. æª¢æŸ¥ç¾æœ‰å®‰è£ç‹€æ…‹

é¦–å…ˆï¼Œæª¢æŸ¥ç³»çµ±æ˜¯å¦å·²å®‰è£ `httpd` (Apache)ã€`mariadb` å’Œ `php`ï¼š

```bash
brew list --versions httpd mariadb php
```
2. ç¢ºèª Apache (httpd) å’Œ PHP-FPM æœå‹™
ç¢ºèª Apache å·²å®‰è£ä¸”é‹è¡Œï¼Œä¸¦æº–å‚™å•Ÿå‹• PHP-FPMï¼š

æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
brew services list
```
ç¢ºä¿ Apache æœå‹™å·²å•Ÿå‹•
```bash
brew services start httpd
```

## Part 2: MariaDB å®‰è£èˆ‡è³‡æ–™åº«è¨­å®š
1. è™•ç† MySQL è¡çª (è‹¥å­˜åœ¨)
å¦‚æœç³»çµ±å…ˆå‰å®‰è£é MySQLï¼Œæ‚¨æœƒæ”¶åˆ°è¡çªéŒ¯èª¤ã€‚éœ€è¦å…ˆå°‡å…¶è§£é™¤é€£çµä¸¦ç§»é™¤æ®˜ç•™æª”æ¡ˆã€‚

- è§£é™¤é€£çµ MySQL
```bash
brew unlink mysql
```
- å¾¹åº•ç§»é™¤ MySQL (è‹¥ç¢ºå®šä¸å†ä½¿ç”¨)
```bash
brew uninstall mysql
```

2. å®‰è£ MariaDB
```bash
brew install mariadb
```

3. å•Ÿå‹•æœå‹™èˆ‡ Socket é€£çµä¿®æ­£ (é—œéµæ­¥é©Ÿ)
MariaDB å•Ÿå‹•å¤±æ•—æˆ– ERROR 2002 æ˜¯å¸¸è¦‹å•é¡Œï¼Œéœ€è¦å»ºç«‹ Socket æª”æ¡ˆçš„ç¬¦è™Ÿé€£çµä¾†è§£æ±ºã€‚

- å•Ÿå‹• MariaDB æœå‹™
```bash
brew services start mariadb
```
- å»ºç«‹ Socket ç¬¦è™Ÿé€£çµ (è§£æ±º ERROR 2002)
- Homebrew å°‡ Socket æ”¾åœ¨å…¶ /var ç›®éŒ„ï¼Œéœ€é€£çµåˆ° /tmp
```bash
sudo ln -sf $(brew --prefix mariadb)/var/mysql/mysql.sock /tmp/mysql.sock
```
4. è³‡æ–™åº«å®‰å…¨é…ç½®èˆ‡ Root å¯†ç¢¼è¨­å®š
ç”±æ–¼æ–°ç‰ˆ MariaDB é è¨­ä½¿ç”¨ unix_socket é©—è­‰ï¼Œè¨­å®šå¯†ç¢¼éœ€è¦ç¹é mariadb-secure-installation çš„é™åˆ¶ã€‚

- ä»¥ sudo èº«ä»½ç™»å…¥è³‡æ–™åº« (åˆ©ç”¨ unix_socket é©—è­‰)
```bash
sudo mariadb
```
åœ¨ MariaDB [(none)]> æç¤ºç¬¦ä¸‹ï¼Œè¨­å®šæ‚¨çš„ Root å¯†ç¢¼ï¼š

-- è«‹å°‡ <æ‚¨çš„æ–°å¯†ç¢¼> æ›¿æ›æˆæ‚¨æƒ³è¨­å®šçš„å¯†ç¢¼
```bash
ALTER USER 'root'@'localhost' IDENTIFIED BY '<æ‚¨çš„æ–°å¯†ç¢¼>';
FLUSH PRIVILEGES;
exit
```
æ¸¬è©¦é€£ç·šï¼š
```bash
mariadb -u root -p
```
- è¼¸å…¥æ‚¨å‰›æ‰è¨­å®šçš„æ–°å¯†ç¢¼

## Part 3: é…ç½® Apache ä¼ºæœå™¨ (ä½¿ç”¨ PHP-FPM)
æˆ‘å€‘å°‡æ¡ç”¨é«˜æ•ˆèƒ½çš„ PHP-FPM æ¶æ§‹ã€‚

1. å•Ÿå‹• PHP-FPM æœå‹™
```bash
brew services start php
```
2. é…ç½® Apache ä¸»è¨­å®šæª” (httpd.conf)
é–‹å•Ÿ Apache è¨­å®šæª”ï¼š
```bash
nano $(brew --prefix httpd)/etc/httpd/httpd.conf
```

A. å•Ÿç”¨å¿…è¦çš„æ¨¡çµ„ (Uncomment/æ–°å¢)
ç¢ºä¿ä»¥ä¸‹æ¨¡çµ„å·²å•Ÿç”¨ï¼š

```bash

LoadModule proxy_module lib/httpd/modules/mod_proxy.so
LoadModule proxy_fcgi_module lib/httpd/modules/mod_proxy_fcgi.so
LoadModule rewrite_module lib/httpd/modules/mod_rewrite.so
```
B. è®Šæ›´ä½¿ç”¨è€…/ç¾¤çµ„ (é¿å…æ¬Šé™å•é¡Œ)
å°‡ Apache çš„é‹è¡Œç”¨æˆ¶æ”¹ç‚ºæ‚¨çš„ç³»çµ±ç”¨æˆ¶ï¼Œé¿å… Joomla åœ¨å®‰è£æˆ–æ›´æ–°æ™‚é‡åˆ°æ¬Šé™éŒ¯èª¤ï¼š

```bash

User peter  # æ›¿æ›ç‚ºä½ çš„ç”¨æˆ¶åï¼Œä¾‹å¦‚ï¼šUser peter
Group staff # é€™æ˜¯ macOS é è¨­ç”¨æˆ¶çµ„
```
C. è¨­å®š PHP-FPM è™•ç†è¦å‰‡
åœ¨æª”æ¡ˆæœ«å°¾æˆ–å…¶ä»–é©ç•¶ä½ç½®ï¼Œæ–°å¢ FPM ä»£ç†è¦å‰‡ï¼š
```bash

# ç¢ºä¿ DirectoryIndex åŒ…å« index.php
<IfModule dir_module>
    DirectoryIndex index.html index.php
</IfModule>

# å°‡æ‰€æœ‰ .php æª”æ¡ˆè«‹æ±‚ä»£ç†åˆ° PHP-FPM æœå‹™ (é è¨­ Port 9000)
<FilesMatch \.php$>
    SetHandler "proxy:fcgi://127.0.0.1:9000"
</FilesMatch>
```

D. å•Ÿç”¨ Virtual Host é…ç½®
æ‰¾åˆ°ä¸¦å–æ¶ˆè¨»é‡‹ (ç§»é™¤ #) é€™ä¸€è¡Œï¼š

```bash

Include /opt/homebrew/etc/httpd/extra/httpd-vhosts.conf
```
3. è¨­å®šè™›æ“¬ä¸»æ©Ÿ (httpd-vhosts.conf)
ç‚ºæ‚¨çš„ Joomla å°ˆæ¡ˆè¨­å®šä¸€å€‹å°ˆå±¬çš„ç¶²åŸŸ (ä¾‹å¦‚ joomla.local)ã€‚

```bash

nano $(brew --prefix httpd)/etc/httpd/extra/httpd-vhosts.conf
```
æ–°å¢ Virtual Host é…ç½®ï¼š (è«‹æ›¿æ›ç‚ºæ‚¨çš„ç¶²ç«™è·¯å¾‘)
```bash

<VirtualHost *:80>
    DocumentRoot "/Users/peter/Sites/joomla"
    ServerName joomla.local
    
    <Directory "/Users/peter/Sites/joomla">
        # å•Ÿç”¨ .htaccess æª”æ¡ˆè™•ç† (Joomla éœ€æ±‚)
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

```
4. é‡å•Ÿ Apache æœå‹™
```bash

brew services restart httpd
```bash

## Part 4: ç¶²åŸŸè§£æèˆ‡æœ€çµ‚é©—è­‰
1. ç·¨è¼¯ hosts æª”æ¡ˆ
è®“æ‚¨çš„é›»è…¦çŸ¥é“ joomla.local æ‡‰è©²æŒ‡å‘æœ¬æ©Ÿã€‚

```bash
sudo nano /etc/hosts
```
æ–°å¢ä»¥ä¸‹å…§å®¹ï¼š
```bash
# Homebrew Virtual Hosts
127.0.0.1 joomla.local
```
2. æœ€çµ‚é©—è­‰
å°‡ Joomla å®‰è£æª”æ¡ˆè§£å£“ç¸®ä¸¦æ”¾å…¥æ‚¨è¨­å®šçš„ DocumentRoot (ä¾‹å¦‚ /Users/peter/Sites/joomla)ã€‚

åœ¨ç€è¦½å™¨ä¸­è¨ªå•ï¼šhttp://joomla.localã€‚

æ‚¨ç¾åœ¨å¯ä»¥é–‹å§‹ Joomla çš„å®‰è£ï¼Œä¸¦ä½¿ç”¨æ‚¨è¨­å®šçš„ MariaDB è³‡è¨Šäº†ï¼